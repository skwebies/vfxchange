/*!
 DMXzone Datastore
 Version: 1.0.0
 (c) 2020 DMXzone.com
 @build 2020-02-06 14:49:14
 */
dmx.Component("datastore",{initialData:function(){return{data:[]}},attributes:{session:{type:Boolean,default:!1}},methods:{insert:function(t){Array.isArray(t)?t.forEach(function(t){this._insert(t)},this):this._insert(t),this._store()},update:function(t,r){Array.isArray(t)?t.forEach(function(t){this._update(t,r)},this):this._update(t,r),this._store()},delete:function(t){Array.isArray(t)?t.forEach(function(t){this._delete(t)},this):this._delete(t),this._store()},clear:function(){this.records=[],this.lastid=0,this._store()},get:function(t){return this._filter(t)}},render:function(t){this.$node=null,this.store=window[this.props.session?"sessionStorage":"localStorage"],this.records=[],this.lastid=0;try{var r=this.store.getItem("datastore_"+this.name);r&&((r=JSON.parse(r)).records&&(this.records=r.records),r.lastid&&(this.lastid=r.lastid))}catch(t){console.warn("Error parsing datastore",t)}this.set("data",this.records.slice(0))},_filter:function(s){return"number"==typeof s&&(s={$id:s}),this.records.filter(function(t){for(var r in s)if(t[r]===s[r])return!0;return!1})},_parseData:function(t){if("object"!=typeof t||Array.isArray(t))return!1;try{for(var r in t){var s=t[r];"string"==typeof s&&0===s.indexOf("{{")&&(t[r]=dmx.parse(s,new dmx.DataScope(t,this)))}}catch(t){return console.error(t),!1}return!0},_insert:function(t){this._parseData(t)?this.records.push(Object.assign({},t,{$id:++this.lastid})):console.warn("Invalid data!",t)},_update:function(t,r){this._parseData(r)?this._filter(t).forEach(function(t){Object.assign(t,r)}):console.warn("Invalid data!",r)},_delete:function(s){this.records=this.records.filter(function(t){for(var r in s)if(t[r]===s[r])return!1;return!0})},_store:function(){JSON.stringify({records:this.records,lastid:this.lastid})!==this.store.getItem("datastore_"+this.name)&&(this.store.setItem("datastore_"+this.name,JSON.stringify({records:this.records,lastid:this.lastid})),this.set("data",this.records.slice(0)))}});
//# sourceMappingURL=../maps/dmxDatastore.js.map
